<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModel="clr-namespace:MauiApp.ViewModels"
             x:Class="MauiApp.Views.TestView"
             x:DataType="viewModel:TestViewModel"
             Title="Тест">
    
    <ContentPage.Content>
        <StackLayout Padding="20" Spacing="20">

            <Label Text="{Binding CurrentTask.Text, FallbackValue='Задание недоступно'}" 
                   FontSize="20" 
                   LineBreakMode="WordWrap" />
            
            <Image Source="{Binding CurrentTask.Image, Converter={StaticResource BytesToImageConverter}}"
                   HeightRequest="150"
                   Aspect="AspectFit"
                   IsVisible="{Binding CurrentTask.Image, Converter={StaticResource NullToBoolConverter}}" 
            />

            <Button 
                    Text="{Binding CurrentTask.File}"
                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DownloadFileCommand}"
                    CommandParameter="{Binding CurrentTask}"
                    TextColor="White"
                    BackgroundColor="#007ACC"
                    FontSize="16"
                    CornerRadius="10"
                    Padding="12,6"
                    HorizontalOptions="FillAndExpand"
                    Margin="0,10,0,0"
                    IsVisible="{Binding CurrentTask.File, Converter={StaticResource NullToBoolConverter}}" />


            <Entry Text="{Binding CurrentAnswer.Answer, Mode=TwoWay}"
                   Placeholder="Введите ответ"
                   Completed="Entry_Completed" />

            <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="30">
                <Button Text="Назад"
                        Command="{Binding PreviousTaskCommand}"
                        CommandParameter="{Binding Model}"/>
                <Button Text="Вперёд"
                        Command="{Binding NextTaskCommand}"
                        CommandParameter="{Binding Model}"/>
            </StackLayout>
            
            <Button Text="Завершить тест" 
                    Command="{Binding CheckTestCommand}"
                    BackgroundColor="#007ACC"
                    TextColor="White"
                    FontSize="16"
                    CornerRadius="10"
                    Padding="12,6"
                    HorizontalOptions="Center"
                    VerticalOptions="End"
                    Margin="0,20" />

        </StackLayout>
    </ContentPage.Content>
</ContentPage>